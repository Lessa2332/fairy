<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ü¶∑ AR Nikadent-Family</title>

    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script> 
    
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">

    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Comic Neue', 'Comic Sans MS', cursive, sans-serif;
            text-transform: none;
            background: #f0f0f0;
        }
        a-scene {
            width: 100% !important;
            height: 100% !important;
            position: fixed;
            top: 0;
            left: 0;
            background: transparent;
        }
        .arjs-loader {
            height: 100%;
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
            background: rgba(255, 255, 255, 0.95);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #0057B8;
            font-size: 1.5em;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            font-family: 'Comic Neue', sans-serif;
            text-transform: none;
        }
        
        /* === –ù–û–í–ï –†–û–ó–¢–ê–®–£–í–ê–ù–ù–Ø –ö–ù–û–ü–û–ö === */
        .ui-btn {
            position: fixed;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            text-decoration: none;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
            display: none;
            font-family: 'Comic Neue', sans-serif;
            text-transform: none;
            white-space: nowrap;
            width: 40%; /* –û–±–º–µ–∂–∏–º–æ —à–∏—Ä–∏–Ω—É */
            max-width: 200px;
        }

        /* –õ—ñ–≤–∞ –∫–æ–ª–æ–Ω–∫–∞ (–Ü–Ω—Ñ–æ) */
        #soundBtn { bottom: 200px; left: 10px; right: auto; background: linear-gradient(45deg, #00CED1, #20B2AA); color: white; }
        #rulesBtn { bottom: 130px; left: 10px; right: auto; background: linear-gradient(45deg, #FFD700, #FFA500); color: black; }
        
        /* –ü—Ä–∞–≤–∞ –∫–æ–ª–æ–Ω–∫–∞ (–°—Ç–∞—Ä—Ç –ì—Ä–∏) */
        #startGame1Btn { bottom: 200px; right: 10px; left: auto; background: linear-gradient(45deg, #FF6B6B, #FF8E53); color: white; }
        #startGame2Btn { bottom: 130px; right: 10px; left: auto; background: linear-gradient(45deg, #87CEFA, #4682B4); color: white; }
        
        /* –ö–Ω–æ–ø–∫–∏ –ø—ñ–¥ —á–∞—Å –≥—Ä–∏ (–ø–æ —Ü–µ–Ω—Ç—Ä—É) */
        #endBtn, #cleaningEndBtn, #stopBtn {
            position: fixed;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            padding: 14px 25px;
            font-size: 1.1em;
            background: linear-gradient(45deg, #ff4757, #ff6b81);
            color: white;
            width: auto;
            max-width: none;
        }

        /* –ö—É—Ç–æ–≤—ñ –∫–Ω–æ–ø–∫–∏ */
        .corner-btn {
            position: fixed;
            bottom: 20px;
            padding: 10px 18px;
            border-radius: 25px;
            font-size: 0.95em;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            display: none;
            font-family: 'Comic Neue';
            z-index: 1100;
            text-decoration: none;
            animation: pulse 2s infinite;
            border: none;
        }
        #youtubeBtn { left: 20px; background: linear-gradient(45deg, #ff4757, #ff6348); color: white; }
        #aboutBtn { right: 20px; background: linear-gradient(45deg, #4CAF50, #8BC34A); color: white; animation: none; }
        
        /* ... (–Ü–Ω—à—ñ —Å—Ç–∏–ª—ñ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –±–µ–∑ –∑–º—ñ–Ω) ... */
        .ui-info-text {
            position: fixed; left: 10px; top: 10px; z-index: 500;
            font-family: 'Comic Neue'; text-align: left; font-weight: bold;
            text-shadow: 2px 2px 6px rgba(255, 255, 255, 0.7);
        }
        #endMessage, #rulesMessage {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(74,21,75,0.95); color: white; padding: 25px;
            border-radius: 15px; z-index: 10000; font-size: 1.2em;
            text-align: center; font-family: 'Comic Neue';
            box-shadow: 0 10px 30px rgba(0,0,0,0.6); display: none;
            max-width: 80%;
        }
        #rulesMessage {
            background: linear-gradient(135deg, #4A00E0, #8E2DE2);
            font-size: 1.1em;
            border: 3px solid #FFD700;
        }
        #rulesMessage button {
            margin-top: 20px; padding: 10px 20px; border: none; border-radius: 20px;
            background: #FFD700; color: #4A00E0; font-weight: bold; cursor: pointer;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="arjs-loader" id="loader">
        <div class="pulse">ü¶∑ –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ "Nikadent-Family"!</div>
        <div style="margin-top: 20px; font-size: 1.1em; font-weight: bold; color: #ff0000;">
            ‚ùó –£–≤–∞–≥–∞: –ù–∞–≤–µ–¥–∏ –∫–∞–º–µ—Ä—É –Ω–∞ –≤—ñ–∑–∏—Ç—ñ–≤–∫—É, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –∑—É–±—á–∏–∫!
        </div>
        <div style="margin-top: 10px; font-size: 0.9em;">
            –ü–æ—Å—Ç—É–∫–∞–π, –ø–æ–∫—Ä—É—Ç–∏ —Ç–∞ –ø–æ–º–∞—Å—à—Ç–∞–±—É–π –∑—É–±—á–∏–∫ –ø–µ—Ä–µ–¥ –≥—Ä–æ—é! üòä
        </div>
    </div>

    <p id="timerText" class="ui-info-text">‚è≥ –ß–∞—Å: 00</p>
    <p id="scoreText" class="ui-info-text">üåü –ë–∞–ª—ñ–≤: 0</p>

    <div id="rulesMessage">
        <h3>üí° –ü—Ä–∞–≤–∏–ª–∞ –ì—Ä–∏ "–ó–¥–æ—Ä–æ–≤–∞ –£—Å–º—ñ—à–∫–∞"!</h3>
        <p><strong>–ï—Ç–∞–ø 1: "–ó–¥–æ—Ä–æ–≤–∏–π –í–∏–±—ñ—Ä" (60 —Å–µ–∫)</strong></p>
        <ul>
            <li>‚úÖ **–ö–ª—ñ–∫–∞–π** —Ç—ñ–ª—å–∫–∏ –Ω–∞ **–∫–æ—Ä–∏—Å–Ω—É** —ó–∂—É —Ç–∞ –ø—Ä–µ–¥–º–µ—Ç–∏ (üçé, ü¶∑, ü™•). –û—Ç—Ä–∏–º–∞—î—à **+10 –±–∞–ª—ñ–≤**.</li>
            <li>‚ùå **–ù–ï –ö–õ–Ü–ö–ê–ô** –Ω–∞ —à–∫—ñ–¥–ª–∏–≤—É —ó–∂—É (üçî, üçü, üç≠). –í—Ç—Ä–∞—Ç–∏—à **-5 –±–∞–ª—ñ–≤**.</li>
        </ul>
        <hr style="border-color: #FFD700;">
        <p><strong>–ï—Ç–∞–ø 2: "–ß–∏—Å—Ç–∫–∞ –ó—É–±—ñ–≤" (20 —Å–µ–∫)</strong></p>
        <ul>
            <li>üßπ –®–≤–∏–¥–∫–æ **–≤–∏—Ç–∏—Ä–∞–π –ø–∞–ª—å—Ü–µ–º (–∞–±–æ –∫–ª—ñ–∫–æ–º)** –≤—Å—ñ –∂–æ–≤—Ç—ñ –ø–ª—è–º–∏ –∑ –≤–µ–ª–∏–∫–æ–≥–æ –∑—É–±—á–∏–∫–∞. –ö–æ–∂–Ω–∞ –ø–ª—è–º–∞ **+10 –±–∞–ª—ñ–≤**!</li>
        </ul>
        <p>üëâ **–ü–∞—É–∑–∞:** –î–≤—ñ—á—ñ —à–≤–∏–¥–∫–æ —Ç–æ—Ä–∫–Ω–∏—Å—å –µ–∫—Ä–∞–Ω–∞ (–ø–æ–¥–≤—ñ–π–Ω–∏–π —Ç–∞–ø).</p>
        <button id="closeRulesBtn">–ó—Ä–æ–∑—É–º—ñ–ª–æ! –ü–æ—á–∏–Ω–∞—î–º–æ!</button>
    </div>

    <div id="endMessage"></div>

    <div id="canvasGameContainer" style="display: none;">
        <canvas id="gameCanvas"></canvas>
        <button id="endBtn" class="ui-btn" style="display: block;">üõë –ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ —á–∏—Å—Ç–∫–∏</button>
    </div>

    <div id="cleaningGameContainer" style="display: none;">
        <canvas id="cleaningCanvas"></canvas>
        <button id="cleaningEndBtn" class="ui-btn" style="display: block;">‚úÖ –ì–æ—Ç–æ–≤–æ!</button>
    </div>

    <a-scene
        mindar-image="imageTargetSrc: my-marker.mind;"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
        loading-screen="enabled: false"
        embedded
        renderer="colorManagement: true; physicallyCorrectLights: true;"
        touch-gestures="targetId: tooth-model; initialScale: 0.3;"
    >
        <a-assets>
            <a-asset-item id="toothModel" src="assets/3d_models/a-gltf-model.glb"></a-asset-item>
            <audio id="bg-music" src="assets/audio/sound4.mp3" preload="auto" muted playsinline crossorigin="anonymous"></audio>
            <audio id="applauseSound" src="assets/audio/applause.mp3" preload="auto" muted playsinline crossorigin="anonymous"></audio>
            <audio id="toothClickSound" src="assets/audio/sound5.mp3" preload="auto" muted playsinline crossorigin="anonymous"></audio>
        </a-assets>

        <a-camera
            look-controls="enabled: false"
            position="0 0 0"
        >
             <a-cursor
                raycaster="objects: .clickable;" 
                cursor="fuse: false; maxDistance: 10"
                position="0 0 -1"
                geometry="primitive: ring; radiusOuter: 0.015; radiusInner: 0.008"
                material="color: #FFD700; shader: flat"
            ></a-cursor>
        </a-camera>

        <a-entity mindar-image-target="targetIndex: 0">
            <a-gltf-model
                id="tooth-model"
                class="clickable"
                src="#toothModel"
                scale="0.3 0.3 0.3"
                position="0 0 0.1"
                rotation="0 0 0"
                shadow
                animation-mixer="clip: Idle; loop: repeat; timeScale: 1.0; autoplay: true;">
            </a-gltf-model>
        </a-entity>
    </a-scene>

    <button id="soundBtn" class="ui-btn">üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫</button>
    <button id="rulesBtn" class="ui-btn">‚ùì –ü—Ä–∞–≤–∏–ª–∞ –ì—Ä–∏</button>
    <button id="startGame1Btn" class="ui-btn">üöÄ –ì—Ä–∞ 1: –í–∏–±—ñ—Ä</button>
    <button id="startGame2Btn" class="ui-btn">üßº –ì—Ä–∞ 2: –ß–∏—Å—Ç–∫–∞</button>
    <button id="stopBtn" class="ui-btn" style="display: none;">‚è∏ –ü–∞—É–∑–∞</button>
    
    <a href="https://www.youtube.com/@23smartlessa32?si=d3NhKDot8U8Mc2Hi" id="youtubeBtn" class="corner-btn" target="_blank" rel="noopener noreferrer">‚ù§Ô∏è –ê–≤—Ç–æ—Ä</a>
    <a href="https://nikadent-family.com.ua/ua/" id="aboutBtn" class="corner-btn" target="_blank" rel="noopener noreferrer">‚ÑπÔ∏è –ü—Ä–æ –Ω–∞—Å</a>

    <script>
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∑–º—ñ–Ω–Ω–∏—Ö (—á–∞—Å—Ç–∏–Ω–∞ 1)
        function fixHeight() { document.body.style.height = window.innerHeight + 'px'; }
        fixHeight();
        window.addEventListener('resize', fixHeight);

        const loader = document.querySelector('#loader');
        const targetEntity = document.querySelector('a-entity[mindar-image-target]');
        const toothModel = document.querySelector('#tooth-model');
        const startGame1Btn = document.querySelector('#startGame1Btn');
        const startGame2Btn = document.querySelector('#startGame2Btn');
        const stopBtn = document.querySelector('#stopBtn');
        const rulesBtn = document.querySelector('#rulesBtn');
        const soundBtn = document.querySelector('#soundBtn');
        const youtubeBtn = document.querySelector('#youtubeBtn');
        const aboutBtn = document.querySelector('#aboutBtn');
        const timerText = document.getElementById('timerText');
        const scoreText = document.getElementById('scoreText');
        const bgMusic = document.querySelector('#bg-music');
        const applauseSound = document.querySelector('#applauseSound');
        const toothClickSound = document.querySelector('#toothClickSound');
        const endMessage = document.getElementById('endMessage');
        const rulesMessage = document.getElementById('rulesMessage');
        const closeRulesBtn = document.getElementById('closeRulesBtn');
        const endBtn = document.getElementById('endBtn');
        const cleaningEndBtn = document.getElementById('cleaningEndBtn');

        let isGameRunning = false;
        let isPaused = false;
        let score = 0;
        let emojis = [];
        let startTime = null;
        let inputHandler = null;
        let lastTap = 0;
        let currentGame = null;

        // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω –∫–Ω–æ–ø–∫–∏ –ó–≤—É–∫
        bgMusic.muted = true; // –ü—Ä–∏–º—É—Å–æ–≤–æ –≤–∏–º–∏–∫–∞—î–º–æ –Ω–∞ —Å—Ç–∞—Ä—Ç—ñ –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫—É –Ω–∞ iOS/Android
        soundBtn.textContent = "üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫";
        
        // =========================================================
        // === 1. –ö–û–ú–ü–û–ù–ï–ù–¢ –î–õ–Ø –û–ë–†–û–ë–ö–ò –ñ–ï–°–¢–Ü–í (–û–ë–ï–†–¢–ê–ù–ù–Ø/–ú–ê–°–®–¢–ê–ë) ===
        // =========================================================

        AFRAME.registerComponent('touch-gestures', {
            schema: {
                targetId: { type: 'string', default: '' },
                initialScale: { type: 'number', default: 0.3 }, // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ 0.3 —è–∫ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π
                minScale: { type: 'number', default: 0.15 },
                maxScale: { type: 'number', default: 1.0 },
                rotationSpeed: { type: 'number', default: 0.5 }
            },
            init: function () {
                this.isRotating = false;
                this.isPinching = false;
                this.startPos = { x: 0, y: 0 };
                this.initialDistance = 0;
                this.currentScale = this.data.initialScale;
                this.targetEl = document.querySelector(`#${this.data.targetId}`);
                
                if (!this.targetEl) {
                    console.error('–¶—ñ–ª—å–æ–≤–∏–π –µ–ª–µ–º–µ–Ω—Ç –¥–ª—è –∂–µ—Å—Ç—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ!');
                    return;
                }
                
                // –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ –º–∞—Å—à—Ç–∞–±—É
                const initial = this.data.initialScale;
                this.targetEl.object3D.scale.set(initial, initial, initial);
                
                this.el.addEventListener('touchstart', (e) => {
                    // –î–æ–∑–≤–æ–ª—è—î–º–æ –∂–µ—Å—Ç–∏ –ª–∏—à–µ —è–∫—â–æ –≥—Ä–∞ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞
                    if (isGameRunning) return;

                    e.preventDefault();
                    if (e.touches.length === 1) {
                        this.isRotating = true;
                        this.startPos.x = e.touches[0].pageX;
                        this.startPos.y = e.touches[0].pageY;
                    } else if (e.touches.length === 2) {
                        this.isPinching = true;
                        this.isRotating = false;
                        this.initialDistance = Math.hypot(
                            e.touches[0].pageX - e.touches[1].pageX,
                            e.touches[0].pageY - e.touches[1].pageY
                        );
                        this.currentScale = this.targetEl.object3D.scale.x;
                    }
                });

                this.el.addEventListener('touchmove', (e) => {
                    if (isGameRunning) return; 

                    e.preventDefault();
                    if (this.isPinching && e.touches.length === 2) {
                        const currentDistance = Math.hypot(
                            e.touches[0].pageX - e.touches[1].pageX,
                            e.touches[0].pageY - e.touches[1].pageY
                        );
                        const scaleFactor = currentDistance / this.initialDistance;
                        let newScale = this.currentScale * scaleFactor;
                        
                        // –û–±–º–µ–∂–µ–Ω–Ω—è –º–∞—Å—à—Ç–∞–±—É
                        newScale = Math.max(this.data.minScale, Math.min(this.data.maxScale, newScale));
                        
                        this.targetEl.object3D.scale.set(newScale, newScale, newScale);
                    } else if (this.isRotating && e.touches.length === 1) {
                        const deltaX = (e.touches[0].pageX - this.startPos.x) * this.data.rotationSpeed;
                        const deltaY = (e.touches[0].pageY - this.startPos.y) * this.data.rotationSpeed;
                        
                        this.targetEl.object3D.rotation.y += THREE.MathUtils.degToRad(deltaX);
                        this.targetEl.object3D.rotation.x += THREE.MathUtils.degToRad(deltaY);
                        
                        this.startPos.x = e.touches[0].pageX;
                        this.startPos.y = e.touches[0].pageY;
                    }
                });

                this.el.addEventListener('touchend', () => {
                    this.isRotating = false;
                    this.isPinching = false;
                });
            }
        });
        
        // =========================================================
        // === 2. –û–°–ù–û–í–ù–ê –õ–û–ì–Ü–ö–ê –ü–†–û–Ñ–ö–¢–£ ===
        // =========================================================
        
        // === –í–∑–∞—î–º–æ–¥—ñ—è –∑ –∑—É–±—á–∏–∫–æ–º (–∫–ª—ñ–∫) ===
        toothModel.addEventListener('click', () => {
            if (!isGameRunning && rulesMessage.style.display !== 'block') {
                if (toothClickSound && !toothClickSound.muted) {
                    toothClickSound.currentTime = 0;
                    toothClickSound.play().catch(e => console.log("üîá –ó–≤—É–∫ –Ω–µ –∑–∞–ø—É—Å—Ç–∏–≤—Å—è:", e));
                }
                // –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π –º–∞—Å—à—Ç–∞–± –¥–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó –ø—É–ª—å—Å–∞—Ü—ñ—ó
                const currentScale = toothModel.object3D.scale.x;
                
                toothModel.setAttribute('animation__pulse', {
                    property: 'scale', 
                    to: `${currentScale * 1.2} ${currentScale * 1.2} ${currentScale * 1.2}`, 
                    dur: 200, dir: 'alternate', loop: 2
                });
                
                endMessage.textContent = "ü¶∑ –ü—Ä–∏–≤—ñ—Ç! –ü–æ–∫—Ä—É—Ç–∏ —Ç–∞ –ø–æ–º–∞—Å—à—Ç–∞–±—É–π –º–µ–Ω–µ! –ì–æ—Ç–æ–≤–∏–π –¥–æ –≥—Ä–∏?";
                endMessage.style.display = 'block';
                setTimeout(() => { endMessage.style.display = 'none'; }, 3000);
            }
        });

        // === –ü–æ–¥—ñ—ó –º–∞—Ä–∫–µ—Ä–∞: –ü–æ–∫–∞–∑–∞—Ç–∏/–°—Ö–æ–≤–∞—Ç–∏ UI —Ç–∞ –ú—É–∑–∏–∫–∞ ===
        function updateUIOnTarget() {
             const isTargetVisible = targetEntity.object3D.visible;
             if (isTargetVisible) {
                loader.style.display = 'none';
                
                // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –º—É–∑–∏–∫–∏ (muted)
                if (bgMusic.paused) {
                    bgMusic.play().catch(e => console.log("üîá –ú—É–∑–∏–∫–∞ –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª–∞—Å—è (–æ—á—ñ–∫—É—î—Ç—å—Å—è –∫–ª—ñ–∫):", e));
                }
                
                if (!isGameRunning) {
                    // –ü–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ä–µ–∂–∏–º—É "–≥—Ä–∞—Ç–∏—Å—è –∑ –∑—É–±—á–∏–∫–æ–º"
                    startGame1Btn.style.display = 'block';
                    startGame2Btn.style.display = 'block';
                    rulesBtn.style.display = 'block';
                    soundBtn.style.display = 'block';
                }
                // –ö—É—Ç–æ–≤—ñ –∫–Ω–æ–ø–∫–∏ –∑–∞–≤–∂–¥–∏ –≤–∏–¥–Ω–æ, –∫–æ–ª–∏ —î –º–∞—Ä–∫–µ—Ä
                youtubeBtn.style.display = 'block';
                aboutBtn.style.display = 'block';
                
                // –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—ñ–¥ —á–∞—Å –≥—Ä–∏
                if (isGameRunning) {
                    stopBtn.style.display = 'block';
                    timerText.style.display = 'block';
                    scoreText.style.display = 'block';
                }
            } else {
                 // –•–æ–≤–∞—î–º–æ –≤—Å—ñ –∫–Ω–æ–ø–∫–∏, –∫–æ–ª–∏ –º–∞—Ä–∫–µ—Ä –≤—Ç—Ä–∞—á–µ–Ω–æ
                 startGame1Btn.style.display = 'none';
                 startGame2Btn.style.display = 'none';
                 rulesBtn.style.display = 'none';
                 soundBtn.style.display = 'none';
                 stopBtn.style.display = 'none';
                 youtubeBtn.style.display = 'none';
                 aboutBtn.style.display = 'none';
                 timerText.style.display = 'none';
                 scoreText.style.display = 'none';
            }
        }
        
        targetEntity.addEventListener('targetFound', updateUIOnTarget);
        targetEntity.addEventListener('targetLost', updateUIOnTarget);
        // –ù–µ–≤–µ–ª–∏–∫–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è, —è–∫—â–æ –ø–æ–¥—ñ—ó –ø—Ä–æ–ø—É—â–µ–Ω—ñ
        setInterval(updateUIOnTarget, 500);


        // === –ö–µ—Ä—É–≤–∞–Ω–Ω—è –∑–≤—É–∫–æ–º ===
        function toggleSound() {
            bgMusic.muted = !bgMusic.muted;
            applauseSound.muted = !bgMusic.muted;
            toothClickSound.muted = !bgMusic.muted;
            
            soundBtn.textContent = bgMusic.muted ? "üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫" : "üîá –í–∏–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫";
            
            if (!bgMusic.muted) {
                // –Ø–∫—â–æ –≤–º–∏–∫–∞—î–º–æ, –ø—Ä–æ–≥—Ä–∞—î–º–æ
                bgMusic.play().catch(e => console.log("üîá –ú—É–∑–∏–∫–∞ –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª–∞—Å—è:", e));
            } else {
                // –Ø–∫—â–æ –≤–∏–º–∏–∫–∞—î–º–æ, –ø–∞—É–∑–∞
                bgMusic.pause();
            }
        }
        soundBtn.addEventListener('click', toggleSound);

        // === –ü–∞—É–∑–∞ —á–µ—Ä–µ–∑ –ø–æ–¥–≤—ñ–π–Ω–∏–π —Ç–∞–ø —Ç–∞ —ñ–Ω—à—ñ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –∫–Ω–æ–ø–∫–∏ ===
        function handleDoubleTap(e) {
            if (!isGameRunning || rulesMessage.style.display === 'block') return;
            const now = Date.now();
            if (now - lastTap < 300) {
                if (isPaused) {
                    isPaused = false;
                    stopBtn.textContent = "‚è∏ –ü–∞—É–∑–∞";
                    endMessage.style.display = 'none';
                    if (!bgMusic.muted) bgMusic.play();
                    if (currentGame === 'game1') requestAnimationFrame(animateGame1); // –ü–æ—Ç—Ä—ñ–±–Ω–æ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ animateGame1/2
                    else if (currentGame === 'game2') requestAnimationFrame(animateGame2);
                } else {
                    isPaused = true;
                    stopBtn.textContent = "‚ñ∂Ô∏è –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏";
                    bgMusic.pause();
                    endMessage.textContent = "‚è∏ –ü–∞—É–∑–∞. –ü–æ–¥–≤—ñ–π–Ω–∏–π —Ç–∞–ø –¥–ª—è –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è!";
                    endMessage.style.display = 'block';
                }
            }
            lastTap = now;
        }
        document.addEventListener('touchstart', handleDoubleTap, { passive: false });
        
        // ... (–§—É–Ω–∫—Ü—ñ—ó startCanvasGame, initCanvasGame, initCleaningGame —Ç–∞ —ñ–Ω—à—ñ –∑–∞–≥–ª—É—à–∫–∏ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –±–µ–∑ –∑–º—ñ–Ω) ...

        function startCanvasGame(initialTime) {
            isGameRunning = true;
            isPaused = false;
            stopBtn.textContent = "‚è∏ –ü–∞—É–∑–∞";
            stopBtn.style.display = 'block';
            
            // –•–æ–≤–∞—î–º–æ –≤—Å—ñ –∫–Ω–æ–ø–∫–∏ —Å—Ç–∞—Ä—Ç—É/—ñ–Ω—Ñ–æ, –∑–∞–ª–∏—à–∞—î–º–æ –ª–∏—à–µ –ü–∞—É–∑—É/–°—Ç–æ–ø
            startGame1Btn.style.display = 'none';
            startGame2Btn.style.display = 'none';
            rulesBtn.style.display = 'none';
            soundBtn.style.display = 'none';
            youtubeBtn.style.display = 'none';
            aboutBtn.style.display = 'none';
            document.querySelector('a-scene').style.display = 'none'; // –•–æ–≤–∞—î–º–æ AR-—Å—Ü–µ–Ω—É –¥–ª—è –≥—Ä–∏ –Ω–∞ Canvas
            
            if (initialTime > 0) {
                 document.getElementById('canvasGameContainer').style.display = 'block';
                 initCanvasGame(initialTime);
            } else {
                 document.getElementById('cleaningGameContainer').style.display = 'block';
                 initCleaningGame();
            }
        }
        
        function initCanvasGame(duration) {
             // ... –ª–æ–≥—ñ–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó Game 1
             
             startTime = Date.now();
             score = 0; 
             timerText.textContent = `‚è≥ –ß–∞—Å: ${duration}`;
             scoreText.textContent = `üåü –ë–∞–ª—ñ–≤: 0`;
             timerText.style.display = 'block';
             scoreText.style.display = 'block';
             
             function endCanvasGame() {
                 document.getElementById('canvasGameContainer').style.display = 'none';
                 document.getElementById('cleaningGameContainer').style.display = 'block';
                 initCleaningGame();
             }
             
             if (duration > 0) setTimeout(endCanvasGame, duration * 1000); 
             document.getElementById('endBtn').onclick = endCanvasGame;
        }

        function initCleaningGame() {
            currentGame = 'game2';
            // ... –ª–æ–≥—ñ–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó Game 2
            
            timerText.textContent = `‚è≥ –ß–∞—Å: 20`; 
            
            document.getElementById('cleaningEndBtn').onclick = () => {
                endMessage.textContent = `üéâ –ì—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ó–∞–≥–∞–ª—å–Ω–∏–π —Ä–∞—Ö—É–Ω–æ–∫: ${score} –±–∞–ª—ñ–≤!`;
                endMessage.style.display = 'block';
                setTimeout(() => { endMessage.style.display = 'none'; stopGame(); }, 5000);
            };
        }

        function stopGame() {
            isGameRunning = false;
            isPaused = false;
            stopBtn.style.display = 'none';
            
            document.getElementById('canvasGameContainer').style.display = 'none';
            document.getElementById('cleaningGameContainer').style.display = 'none';
            document.querySelector('a-scene').style.display = 'block'; // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ AR-—Å—Ü–µ–Ω—É
            
            timerText.style.display = 'none';
            scoreText.style.display = 'none';
            if (endMessage) endMessage.style.display = 'none';
            
            bgMusic.pause();
            
            // –ü–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ä–µ–∂–∏–º—É "–≥—Ä–∞—Ç–∏—Å—è –∑ –∑—É–±—á–∏–∫–æ–º"
            if (targetEntity.object3D.visible) {
                 startGame1Btn.style.display = 'block';
                 startGame2Btn.style.display = 'block';
                 rulesBtn.style.display = 'block';
                 soundBtn.style.display = 'block';
                 youtubeBtn.style.display = 'block';
                 aboutBtn.style.display = 'block';
            }
        }

        
        // –ö–µ—Ä—É–≤–∞–Ω–Ω—è –∫–Ω–æ–ø–∫–∞–º–∏
        startGame1Btn.addEventListener('click', () => showRulesBeforeStart('game1'));
        startGame2Btn.addEventListener('click', () => showRulesBeforeStart('game2'));
        closeRulesBtn.addEventListener('click', () => {
            rulesMessage.style.display = 'none';
            if (currentGame === 'game1') startCanvasGame(60);
            else if (currentGame === 'game2') startCanvasGame(0);
        });
        stopBtn.addEventListener('click', () => {
            if (isPaused) { handleDoubleTap({ timeStamp: Date.now() + 300 }); } 
            else { isPaused = true; stopBtn.textContent = "‚ñ∂Ô∏è –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏"; bgMusic.pause(); endMessage.textContent = "‚è∏ –ü–∞—É–∑–∞"; endMessage.style.display = 'block'; setTimeout(() => endMessage.style.display = 'none', 2000); }
        });
        rulesBtn.addEventListener('click', () => { rulesMessage.style.display = 'block'; });
        // –ö—ñ–Ω–µ—Ü—å JS
    </script>
</body>
</html>
