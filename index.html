<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü¶∑ AR Nikadent-Family</title>

    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">

    <style>
        html, body {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            overflow: hidden;
            font-family: 'Comic Neue', cursive, sans-serif;
            text-transform: none;
        }
        a-scene {
            width: 100% !important;
            height: 100% !important;
            position: fixed; top: 0; left: 0;
            background: transparent;
        }
        .arjs-loader {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(255,255,255,0.9);
            z-index: 9999;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            color: #0057B8; font-size: 1.5em; text-align: center;
            padding: 20px; box-sizing: border-box;
            font-family: 'Comic Neue';
        }
        .ui-btn {
            position: fixed;
            left: 50%; transform: translateX(-50%);
            padding: 16px 30px; border-radius: 40px;
            font-size: 1.2em; font-weight: bold;
            z-index: 1000;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            cursor: pointer; border: none;
            display: none;
            font-family: 'Comic Neue'; text-transform: none;
        }
        .game-btn { bottom: 220px; background: linear-gradient(45deg, #54a0ff, #5f27cd); color: white; }
        .game-btn:nth-child(2) { bottom: 160px; background: linear-gradient(45deg, #00CED1, #20B2AA); }
        .game-btn:nth-child(3) { bottom: 100px; background: linear-gradient(45deg, #FF6B6B, #FF8E53); }

        #backToArBtn {
            bottom: 40px;
            background: linear-gradient(45deg, #7f5af0, #2cbcb4);
            color: white;
        }
        #soundBtn {
            bottom: 280px;
            background: linear-gradient(45deg, #00CED1, #20B2AA);
            color: white;
        }
        #youtubeBtn, #aboutBtn {
            position: fixed; bottom: 20px; padding: 10px 16px;
            border-radius: 25px; font-size: 0.9em; text-decoration: none;
            z-index: 1100; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            font-family: 'Comic Neue'; display: none;
        }
        #youtubeBtn { left: 20px; background: linear-gradient(45deg, #ff4757, #ff6348); color: white; }
        #aboutBtn { right: 20px; background: linear-gradient(45deg, #54a0ff, #5f27cd); color: white; }

        .ui-info-text {
            position: fixed; left: 10px; top: 10px;
            z-index: 500; font-family: 'Comic Neue';
            font-weight: bold; text-shadow: 2px 2px 6px rgba(0,0,0,0.7);
        }
        #timerText, #scoreText { display: none; }
        #canvasGameContainer, #cleaningGameContainer, #detectiveGameContainer {
            z-index: 1000; position: relative;
        }
        #endMessage {
            position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(74,21,75,0.9); color: white;
            padding: 20px; border-radius: 15px; z-index: 10000;
            font-size: 1.2em; text-align: center;
            font-family: 'Comic Neue'; box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            display: none;
        }
    </style>
</head>
<body>
    <div class="arjs-loader" id="loader">
        <div>ü¶∑ –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ Nikadent Family!</div>
        <div style="margin-top: 15px; font-size: 1.1em;">
            –ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ –≤—ñ–∑–∏—Ç—ñ–≤–∫—É, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –∑—É–±—á–∏–∫–∞!
        </div>
    </div>

    <p id="timerText" class="ui-info-text">‚è≥ –ß–∞—Å: 00</p>
    <p id="scoreText" class="ui-info-text">üåü –ë–∞–ª—ñ–≤: 0</p>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ —ñ–≥–æ—Ä -->
    <div id="canvasGameContainer" style="display: none;"><canvas id="gameCanvas"></canvas></div>
    <div id="cleaningGameContainer" style="display: none;"><canvas id="cleaningCanvas"></canvas></div>
    <div id="detectiveGameContainer" style="display: none;">
        <canvas id="detectiveCanvas"></canvas>
    </div>

    <div id="endMessage"></div>

    <!-- AR-—Å—Ü–µ–Ω–∞ -->
    <a-scene
        mindar-image="imageTargetSrc: my-marker.mind;"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
        loading-screen="enabled: false"
        embedded
        renderer="colorManagement: true; physicallyCorrectLights: true;"
    >
        <a-assets>
            <a-asset-item id="toothModel" src="assets/3d_models/a-gltf-model.glb"></a-asset-item>
            <audio id="bg-music" src="assets/audio/sound4.mp3" preload="auto" muted playsinline crossorigin="anonymous"></audio>
            <audio id="applauseSound" src="assets/audio/applause.mp3" preload="auto" muted playsinline crossorigin="anonymous"></audio>
            <audio id="detectiveSound" src="assets/audio/detective.mp3" preload="auto" muted playsinline crossorigin="anonymous"></audio>
        </a-assets>

        <a-camera position="0 0 0" look-controls="enabled: false">
            <a-cursor raycaster="objects: .clickable;"
                      cursor="fuse: false; maxDistance: 10"
                      position="0 0 -1"
                      geometry="primitive: ring; radiusOuter: 0.015; radiusInner: 0.008"
                      material="color: #FFD700; shader: flat">
            </a-cursor>
        </a-camera>

        <a-entity mindar-image-target="targetIndex: 0">
            <a-gltf-model
                id="tooth-model"
                src="#toothModel"
                scale="0.3 0.3 0.3"
                position="0 0 0.1"
                rotation="0 0 0"
                shadow
                animation-mixer="clip: Idle; loop: repeat; timeScale: 1.0; autoplay: true;">
            </a-gltf-model>
        </a-entity>
    </a-scene>

    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <button id="game1Btn" class="ui-btn game-btn">üéØ –ó–¥–æ—Ä–æ–≤–∏–π –í–∏–±—ñ—Ä</button>
    <button id="game2Btn" class="ui-btn game-btn">ü™• –ß–∏—Å—Ç–∫–∞ –ó—É–±—ñ–≤</button>
    <button id="game3Btn" class="ui-btn game-btn">üîç –ó—É–±–Ω–∏–π –î–µ—Ç–µ–∫—Ç–∏–≤</button>
    <button id="backToArBtn" class="ui-btn">ü¶∑ –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –∑—É–±—á–∏–∫–∞</button>
    <button id="soundBtn" class="ui-btn">üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫</button>

    <a href="https://www.youtube.com/@23smartlessa32" id="youtubeBtn" target="_blank">‚ù§Ô∏è –ê–≤—Ç–æ—Ä SmartLessa</a>
    <a href="https://nikadent-family.com.ua/ua/" id="aboutBtn" target="_blank">‚ÑπÔ∏è –ü—Ä–æ –Ω–∞—Å</a>

    <script>
        // === –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ ===
        const loader = document.getElementById('loader');
        const targetEntity = document.querySelector('a-entity[mindar-image-target]');
        const scene = document.querySelector('a-scene');
        const bgMusic = document.getElementById('bg-music');
        const detectiveSound = document.getElementById('detectiveSound');
        const applauseSound = document.getElementById('applauseSound');

        const game1Btn = document.getElementById('game1Btn');
        const game2Btn = document.getElementById('game2Btn');
        const game3Btn = document.getElementById('game3Btn');
        const backToArBtn = document.getElementById('backToArBtn');
        const soundBtn = document.getElementById('soundBtn');
        const youtubeBtn = document.getElementById('youtubeBtn');
        const aboutBtn = document.getElementById('aboutBtn');

        const timerText = document.getElementById('timerText');
        const scoreText = document.getElementById('scoreText');
        const endMessage = document.getElementById('endMessage');

        let currentGame = null; // 'game1', 'game2', 'game3', null
        let score = 0;

        // === –ó–≤—É–∫ ===
        function toggleSound() {
            bgMusic.muted = !bgMusic.muted;
            detectiveSound.muted = bgMusic.muted;
            soundBtn.textContent = bgMusic.muted ? "üîä –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫" : "üîá –í–∏–º–∫–Ω—É—Ç–∏ –∑–≤—É–∫";
            if (!bgMusic.muted) bgMusic.play().catch(e => console.log("üîá –ó–≤—É–∫:", e));
        }
        soundBtn.addEventListener('click', toggleSound);

        // === –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –º—ñ–∂ AR —Ç–∞ —ñ–≥—Ä–∞–º–∏ ===
        function showArScene() {
            scene.style.display = 'block';
            document.getElementById('canvasGameContainer').style.display = 'none';
            document.getElementById('cleaningGameContainer').style.display = 'none';
            document.getElementById('detectiveGameContainer').style.display = 'none';
            timerText.style.display = 'none';
            scoreText.style.display = 'none';
            endMessage.style.display = 'none';
            currentGame = null;

            // –ü–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫–∏ —ñ–≥–æ—Ä, —è–∫—â–æ –º–∞—Ä–∫–µ—Ä –∑–Ω–∞–π–¥–µ–Ω–æ
            if (arFound) {
                game1Btn.style.display = 'block';
                game2Btn.style.display = 'block';
                game3Btn.style.display = 'block';
                backToArBtn.style.display = 'none';
                youtubeBtn.style.display = 'block';
                aboutBtn.style.display = 'block';
            }
        }

        function startGame(gameName) {
            currentGame = gameName;
            scene.style.display = 'none';
            game1Btn.style.display = 'none';
            game2Btn.style.display = 'none';
            game3Btn.style.display = 'none';
            backToArBtn.style.display = 'block';
            youtubeBtn.style.display = 'none';
            aboutBtn.style.display = 'none';
            score = 0;
            scoreText.textContent = `üåü –ë–∞–ª—ñ–≤: ${score}`;
            scoreText.style.display = 'block';

            if (gameName === 'game1') initGame1();
            else if (gameName === 'game2') initGame2();
            else if (gameName === 'game3') initGame3();
        }

        // === –ü–æ–¥—ñ—ó –º–∞—Ä–∫–µ—Ä–∞ ===
        let arFound = false;
        targetEntity.addEventListener('targetFound', () => {
            arFound = true;
            loader.style.display = 'none';
            if (!currentGame) {
                game1Btn.style.display = 'block';
                game2Btn.style.display = 'block';
                game3Btn.style.display = 'block';
                soundBtn.style.display = 'block';
                youtubeBtn.style.display = 'block';
                aboutBtn.style.display = 'block';
            }
        });
        targetEntity.addEventListener('targetLost', () => {
            arFound = false;
            if (!currentGame) {
                game1Btn.style.display = 'none';
                game2Btn.style.display = 'none';
                game3Btn.style.display = 'none';
                soundBtn.style.display = 'none';
                youtubeBtn.style.display = 'none';
                aboutBtn.style.display = 'none';
            }
        });

        // === –ö–Ω–æ–ø–∫–∏ ===
        game1Btn.addEventListener('click', () => startGame('game1'));
        game2Btn.addEventListener('click', () => startGame('game2'));
        game3Btn.addEventListener('click', () => startGame('game3'));
        backToArBtn.addEventListener('click', showArScene);

        // === –ì—Ä–∞ 1: –ó–¥–æ—Ä–æ–≤–∏–π –í–∏–±—ñ—Ä ===
        function initGame1() {
            // (—Ç—É—Ç –≤–∞—à–∞ —ñ—Å–Ω—É—é—á–∞ –ª–æ–≥—ñ–∫–∞ –∑ –µ–º–æ–¥–∂—ñ)
            // –î–ª—è –ø—Ä–∏–∫–ª–∞–¥—É ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
            endMessage.textContent = "üéÆ –ì—Ä–∞ '–ó–¥–æ—Ä–æ–≤–∏–π –í–∏–±—ñ—Ä' –∑–∞–ø—É—â–µ–Ω–∞!";
            endMessage.style.display = 'block';
            setTimeout(() => endMessage.style.display = 'none', 2000);
        }

        // === –ì—Ä–∞ 2: –ß–∏—Å—Ç–∫–∞ –ó—É–±—ñ–≤ ===
        function initGame2() {
            endMessage.textContent = "ü™• –ì—Ä–∞ '–ß–∏—Å—Ç–∫–∞ –ó—É–±—ñ–≤' –∑–∞–ø—É—â–µ–Ω–∞!";
            endMessage.style.display = 'block';
            setTimeout(() => endMessage.style.display = 'none', 2000);
        }

        // === –ì—Ä–∞ 3: –ó—É–±–Ω–∏–π –î–µ—Ç–µ–∫—Ç–∏–≤ ===
        function initGame3() {
            endMessage.textContent = "üîç –ì—Ä–∞ '–ó—É–±–Ω–∏–π –î–µ—Ç–µ–∫—Ç–∏–≤' –∑–∞–ø—É—â–µ–Ω–∞!";
            endMessage.style.display = 'block';
            setTimeout(() => endMessage.style.display = 'none', 2000);

            // –¢—É—Ç –±—É–¥–µ –ø–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞ –¥–µ—Ç–µ–∫—Ç–∏–≤–∞:
            // - –ø–æ–∫–∞–∑ 4 –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ –Ω–∞ 5 —Å–µ–∫
            // - –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è –æ–¥–Ω–æ–≥–æ
            // - –≤–∏–±—ñ—Ä –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
            // - 5 —Ä–∞—É–Ω–¥—ñ–≤
            // - –ø—ñ–¥–∫–∞–∑–∫–∞: "–Ø–±–ª—É–∫–∞ –∫–æ—Ä–∏—Å–Ω—ñ, —Ü—É–∫–µ—Ä–∫–∏ ‚Äî –Ω—ñ!"
        }

        // === –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è ===
        window.addEventListener('resize', () => {
            document.body.style.height = window.innerHeight + 'px';
        });
        document.body.style.height = window.innerHeight + 'px';
    </script>
</body>
</html>
